---
- name: parser meta data
  parser_metadata:
    version: 1.0
    command: show run | beg interface
    network_os: ios

- name: match sections
  pattern_match:
    regex: "interface"
    match_all: yes
    match_greedy: yes
  register: section

- name: match interface config values
  pattern_group:
  - name: match name
    pattern_match:
      regex: "interface (.*)"
      content: "{{ item }}"
    register: name
  loop: "{{ section }}"
  register: values

- name: template interface values
  loop: "{{ values }}"
  register: interfaces
  export: yes
  export_as: dict
  json_template:
    template:
    - key: "{{ item.name.matches.0 }}"
      object:
        - key: name
          value: "{{ item.name.matches.0 }}"
